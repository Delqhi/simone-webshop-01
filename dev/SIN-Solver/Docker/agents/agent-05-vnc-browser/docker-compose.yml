# VNC Browser Service for Delqhi-Platform
# Provides HEADFULL Chrome with VNC access
# Alternative to headless Steel Browser

services:
  agent-05-vnc-browser:
    image: siomiz/chrome:latest
    platform: linux/amd64
    container_name: agent-05-vnc-browser
    hostname: agent-05-vnc-browser
    ports:
      - "${VNC_BROWSER_PORT:-50055}:5900"
      - "${VNC_WEB_PORT:-50056}:6901"
      - "${VNC_CDP_PORT:-50057}:9222"
      - "${VNC_API_PORT:-50058}:3000"
    environment:
      - VNC_PW=${VNC_PASSWORD:-delqhi-admin}
      - VNC_RESOLUTION=${VNC_RESOLUTION:-1920x1080}
      - VNC_COL_DEPTH=${VNC_COL_DEPTH:-24}
      - CHROME_OPTS=--remote-debugging-address=0.0.0.0 --remote-debugging-port=9222 --no-sandbox --disable-dev-shm-usage
      - DISPLAY=:1
      - AGENT_NAME=agent-05-vnc-browser
      - AGENT_ID=05-vnc
      - AGENT_ROLE=browser-automation-headfull
      - AGENT_VERSION=1.0.0
      - BROWSER_MODE=headfull
    volumes:
      - vnc-browser-data:/home/user/data
      - vnc-browser-downloads:/home/user/Downloads
      - ./scripts:/home/user/scripts:ro
    networks:
      - sin-solver-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9222/json/version"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
        labels: "service=agent-05-vnc-browser"
    labels:
      - "com.delqhi.service=agent"
      - "com.delqhi.agent-number=05-vnc"
      - "com.delqhi.agent-role=browser-automation-headfull"
      - "com.delqhi.browser-mode=headfull"
      - "com.delqhi.vnc-enabled=true"
      - "com.delqhi.version=1.0"

volumes:
  vnc-browser-data:
    driver: local
  vnc-browser-downloads:
    driver: local

networks:
  sin-solver-network:
    external: true
    name: sin-solver-network
